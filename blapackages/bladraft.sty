% Copyright (c) 2015-2017 Niklas Koep
%
% This software may be modified and distributed under the terms of the MIT
% license. See the LICENSE file for details.

\NeedsTeXFormat{LaTeX2e}
\ProvidesPackage{bladraft}[2015/03/18 v0.1]

\usepackage[pagewise,switch*]{lineno}
\usepackage[excludeor]{everyhook}
\usepackage{marginnote}
\usepackage{setspace}
\usepackage{todonotes}

\newif\if@review\@reviewfalse
\DeclareOption{review}{
  \@reviewtrue
}

\newif\if@source\@sourcefalse
\DeclareOption{source}{
  \@sourcetrue
}
\newif\if@marginhook\@marginhookfalse

\ProcessOptions\relax

\if@review
  \doublespacing
  \linenumbers
\fi

\if@source
  \PushPostHook{par}{
    \if@marginhook
      \relax
    \else
      \@marginhooktrue
      \marginnote{\small\ttfamily\the\inputlineno}
      \@marginhookfalse
    \fi
  }
\fi

\DeclareDocumentCommand{\@bladraft}{m m o +m}{
  \tikzexternaldisable%
  \todo[inline,color=#1!40,size=\small,caption={}]{%
    \textbf{#2:~}\IfValueTF{#3}{#3 \\ #4}{#4}%
  }%
  \tikzexternalenable%
}

\DeclareDocumentCommand{\blatodo}{o +m}{%
  \@bladraft{green}{TODO}[#1]{#2}%
}

\DeclareDocumentCommand{\blafixme}{o +m}{%
  \@bladraft{red}{FIXME}[#1]{#2}%
}

\endinput
