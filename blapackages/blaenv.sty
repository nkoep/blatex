% Copyright (c) 2015-2017 Niklas Koep
%
% This software may be modified and distributed under the terms of the MIT
% license. See the LICENSE file for details.

\NeedsTeXFormat{LaTeX2e}
\ProvidesPackage{blaenv}[2015/03/18 v0.1]

\ProcessOptions\relax

% AMS theorem configuration
\usepackage{amsthm}
\usepackage{etoolbox}
\usepackage{enumitem}

\newlist{renumerate}{enumerate}{1}
\setlist[renumerate]{label=(\roman*),before=\raggedright}

\usepackage{blaref}

\ifx\thechapter\undefined
  \def\@basecounter{section}
\else
  \def\@basecounter{chapter}
\fi

\newtheorem{definition}{Definition}[\@basecounter]
\newtheorem{proposition}{Proposition}[\@basecounter]
\newtheorem{corollary}{Corollary}[\@basecounter]
\newtheorem{lemma}{Lemma}[\@basecounter]
\newtheorem{theorem}{Theorem}[\@basecounter]

% Add a proof step environment. This allows to create labeled steps/sections
% inside longer proofs.
\newtheoremstyle{@proofstep}{}{}{}{}{\bfseries}{}{ }{%
  \thmname{#1}\thmnumber{ #2:}\thmnote{ #3.}%
}
\theoremstyle{@proofstep}
\newtheorem{proofstep}{Step}
\AtBeginEnvironment{proof}{\setcounter{proofstep}{0}}

% Define a separate style for examples and remarks with non-italic font style.
\newtheoremstyle{blaplain}{}{}{}{}{\bfseries}{.}{ }{}
\theoremstyle{blaplain}
\newtheorem{example}{Example}[\@basecounter]
\newtheorem{remark}{Remark}[\@basecounter]

% AMS theorem environments
\DeclareDocumentCommand{\Thm}{m o m o +m}{%
  \IfValueTF
    {#4}
    {\begin{#3}[{#4}]\IfValueT{#2}{\label{#1:#2}}#5\end{#3}}
    {\begin{#3}\IfValueT{#2}{\label{#1:#2}}#5\end{#3}}
}

% Convenience macros for amsthm environments
\NewDocumentCommand{\Theorem}{d<> o +m}{\Thm{thm}[#1]{theorem}[#2]{#3}}
\NewDocumentCommand{\Definition}{d<> o +m}{\Thm{def}[#1]{definition}[#2]{#3}}
\NewDocumentCommand{\Proposition}{d<> o +m}{%
  \Thm{prop}[#1]{proposition}[#2]{#3}%
}
\NewDocumentCommand{\Example}{d<> o +m}{\Thm{ex}[#1]{example}[#2]{#3}}
\NewDocumentCommand{\Corollary}{d<> o +m}{\Thm{cor}[#1]{corollary}[#2]{#3}}
\NewDocumentCommand{\Lemma}{d<> o +m}{\Thm{lem}[#1]{lemma}[#2]{#3}}
\NewDocumentCommand{\Remark}{d<> o +m}{\Thm{rem}[#1]{remark}[#2]{#3}}
\NewDocumentCommand{\ProofStep}{d<> o +m}{\Thm{step}[#1]{proofstep}[#2]{#3}}

\DeclareDocumentCommand{\Proof}{o +m}{%
  \IfValueTF
    {#1}
    {\begin{proof}[Proof of \blaref{#1}]#2\end{proof}}
    {\begin{proof}#2\end{proof}}
}

% Generic environments
\newcommand{\Env}[2]{\begin{#1}#2\end{#1}}

\endinput
