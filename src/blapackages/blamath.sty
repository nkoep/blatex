% Copyright (c) 2015 Niklas Koep
%
% This software may be modified and distributed under the terms of the MIT
% license. See the LICENSE file for details.

\NeedsTeXFormat{LaTeX2e}
\ProvidesPackage{blamath}[2015/03/18 v0.1]

\newif\if@boldmath\@boldmathfalse
\DeclareOption{boldmath}{
  \@boldmathtrue
}

\ProcessOptions\relax

\usepackage{amsmath,amssymb}
\usepackage{xparse}
\usepackage{pgffor}

\usepackage{blaenv}

% -- Sets --
\newcommand*{\@defineset}[1]{
  \expandafter\newcommand\csname #1\endcsname{\mathbb{#1}}
}
% Positive integers
\@defineset{N}
% Non-negative integers
\newcommand*{\NN}{\mathbb{N}_0}
% Integers
\@defineset{Z}
% Rational numbers
\@defineset{Q}
% Real numbers
\@defineset{R}
% Complex numbers
\@defineset{C}
% Some number field F
\@defineset{F}
% N-sphere
\newcommand*{\sphere}[1]{\mathcal{S}^{#1}}
% Set builder
\DeclareDocumentCommand{\set}{s m o}{%
  \IfValueTF{#3}{\braces{#2 \IfBooleanTF{#1}{\mid}{:} #3}}{\braces{#2}}%
}

% Define style of vectors and matrices.
\if@boldmath
  \def\@symbolstyle#1{\boldsymbol{#1}}
\else
  \def\@symbolstyle#1{\relax#1}
\fi
% Typeset a symbol as (v)ector or (m)atrix.
\newcommand*{\vm}[1]{\@symbolstyle{#1}}
% Define a symbol range. The starred variant treats the symbol names as macros
% upon expansion, e.g., \vm{\sigma} rather than \vm{sigma}.
\DeclareDocumentCommand{\@definesymbols}{s m}{
  \foreach \s in {#2}{
    \expandafter\xdef\csname vm\s\endcsname{
      \noexpand\vm{\IfBooleanTF{#1}{\csname\s\endcsname}{\s}}
    }
  }
}
\@definesymbols{a,...,z}
\@definesymbols{A,...,Z}
\@definesymbols*{
  alpha,beta,gamma,delta,epsilon,varepsilon,zeta,eta,theta,vartheta,iota,kappa,
  lambda,mu,nu,xi,o,pi,rho,varrho,sigma,tau,upsilon,phi,varphi,chi,psi,omega
}
\@definesymbols*{
  Gamma,Delta,Theta,Lambda,Xi,Pi,Sigma,Upsilon,Phi,Psi,Omega
}
% Identity operator
\newcommand*{\Id}{\vm{\mathrm{Id}}}
% Vector of ones
\newcommand*{\ones}{\mathds{1}}

% -- Parenthesis, brackets and braces --
\newcommand*{\parens}[1]{\left(#1\right)}
\newcommand*{\brackets}[1]{\left[#1\right]}
\newcommand*{\braces}[1]{\left\{#1\right\}}

% -- Operators & functions --
% Function definition
\newcommand*{\function}[3]{#1 \colon #2 \to #3}
% Probability measure
\renewcommand*{\P}{\mathbb{P}}
% Expected value
\newcommand*{\E}{\mathbb{E}}
% Variance
\DeclareMathOperator{\var}{Var}
% Covariance
\DeclareMathOperator{\cov}{Cov}
% Entropy
\DeclareMathOperator{\ent}{H}
% Mutual information
\newcommand*{\mi}[2]{\operatorname{I}\left(#1;#2\right)}
% Norm
\newcommand*{\norm}[1]{\left\|#1\right\|}
% Rank
\DeclareMathOperator{\rank}{rank}
% Trace
\DeclareMathOperator{\tr}{tr}
% Inverse
\newcommand*{\inv}[1]{\parens{#1}^{-1}}
% Transpose
\newcommand*{\transp}[1]{#1^\top}
% Adjoint
\newcommand*{\adj}[1]{#1^*}
% Complex conjugation
\newcommand*{\conj}[1]{\overline{#1}}
% Orthogonal complement
\newcommand*{\ocomp}[1]{#1^\bot}
% Optimal point
\newcommand*{\opt}[1]{#1^\star}
% Real and imaginary part
\renewcommand*{\Re}{\operatorname{Re}}
\renewcommand*{\Im}{\operatorname{Im}}
% Inner product
\newcommand*{\inner}[2]{\left\langle#1,#2\right\rangle}
% Diagonal matrix
\newcommand*{\diag}[1]{\operatorname{diag}\braces{#1}}
% Cardinality of a set
\newcommand*{\card}{\#}
% Signum function
\DeclareMathOperator{\sgn}{sgn}
% Domain of a function
\newcommand*{\dom}{\mathoperator{dom}}
% argmin
\DeclareDocumentCommand{\argmin}{s m m}{%
  \operatorname*{argmin}_{#2}\IfBooleanTF{#1}{#3}{\braces{#3}}%
}
% argmax
\DeclareDocumentCommand{\argmax}{s m m}{%
  \operatorname*{argmax}_{#2}\IfBooleanTF{#1}{#3}{\braces{#3}}%
}
% arginf
\DeclareDocumentCommand{\arginf}{s m m}{%
  \operatorname*{arginf}_{#2}\IfBooleanTF{#1}{#3}{\braces{#3}}%
}
% argsup
\DeclareDocumentCommand{\argsup}{s m m}{%
  \operatorname*{argsup}_{#2}\IfBooleanTF{#1}{#3}{\braces{#3}}%
}
% Convex hull
\DeclareMathOperator{\conv}{conv}
% Proximal operator
\newcommand*{\prox}[1]{\operatorname{prox}_{#1}}
% Hard-thresholding operator
\newcommand*{\hard}[1]{H_{#1}}
% Soft-thresholding operator
\newcommand*{\shrink}[1]{S_{#1}}
% Indicator function
\newcommand*{\indicator}[1]{\iota_{#1}}

% Math environments
\DeclareDocumentCommand{\Equation}{s m}{%
  \IfBooleanTF{#1}{\Env{align*}{#2}}{\Env{align}{#2}}%
}
\newcommand*{\PMatrix}[1]{\Env{pmatrix}{#1}}
\newcommand*{\Cases}[1]{\Env{cases}{#1}}

% Optimization problems
%   #1: star (for single line problems)
%   #2: min./max./minimize/maximize
%   #3: domain (optional)
%   #4: objective
%   #5: s.t./subject to
%   #6: constraints
% TODO: Make #5 and #6 optional.
\DeclareDocumentCommand{\Problem}{s m o m m m}{%
  \def\@padding{\;\;}%
  \IfBooleanTF{#1}{%
    \IfValueTF{#3}{\operatorname*{#2}\limits_{#3}}{\operatorname{#2}}%
    \@padding #4%
    \IfValueT{#5}{%
      \IfValueT{#6}{%
        \@padding \text{#5} \@padding #6%
      }%
    }%
  }{%
    \begin{array}{cl}
      \IfValueTF{#3}{\operatorname*{#2}\limits_{#3}}{\operatorname{#2}} & #4 \\
      \text{#5} &
      \setlength\arraycolsep{0pt}%
      \begin{array}[t]{l}
        #6
      \end{array}
    \end{array}
  }
}

% -- Miscellaneous --
% Upright infinitesimal sign for things like df/dx, etc.
\renewcommand*{\d}[1]{\mathrm{d}#1}
% Redefine \iff to use \Leftrightarrow in place of \Longleftrightarrow.
\renewcommand*{\iff}{\Leftrightarrow}
% Corresponds to
\newcommand*{\correspondsto}{\mathrel{\widehat{=}}}

% -- Differential geometry --
% Manifolds
\newcommand*{\man}[1]{\mathcal{#1}}
\newcommand*{\manM}{\man{M}}
\newcommand*{\manN}{\man{N}}
% Directional derivative
\DeclareDocumentCommand{\dderiv}{m o}{%
  % Using \operatorname here adds unwanted whitespace after D.
  % \mathrm{D}{#1}\IfValueT{#2}{[#2]}%
  \mathrm{D}\IfValueT{#2}{_{#2}}{#1}%
}
% Riemannian gradient
\newcommand*{\rgrad}{\operatorname{grad}}
% Tangent space/bundle
\DeclareDocumentCommand{\tspace}{o m}{%
  T\IfValueT{#1}{_{#1}}#2%
}
% Retraction
\newcommand*{\ret}{R}
% Projection onto subspace
\newcommand*{\proj}[1]{\Pi_{#1}}

\endinput
