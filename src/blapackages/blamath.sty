% Copyright (c) 2015 Niklas Koep
%
% This software may be modified and distributed under the terms of the MIT
% license. See the LICENSE file for details.

\NeedsTeXFormat{LaTeX2e}
\ProvidesPackage{blamath}[2015/03/18 v0.1]

\newif\if@boldmath\@boldmathfalse
\DeclareOption{boldmath}{
  \@boldmathtrue
}

\ProcessOptions\relax

\usepackage{amsmath,amssymb}
\usepackage{xparse}
\usepackage{pgffor}

\usepackage{blaenv}

% -- Sets --
\newcommand*{\@defineset}[1]{
  \expandafter\newcommand\csname #1\endcsname{\mathbb{#1}}
}
% Positive integers
\@defineset{N}
% Non-negative integers
\newcommand*{\NN}{\mathbb{N}_0}
% Integers
\@defineset{Z}
% Rational numbers
\@defineset{Q}
% Real numbers
\@defineset{R}
% Complex numbers
\@defineset{C}
% Some number field F
\@defineset{F}
% N-sphere
\newcommand*{\sphere}[1]{\mathcal{S}^{#1}}
% Set builder
\DeclareDocumentCommand{\set}{m o}{%
  \IfValueTF{#2}{\braces{#1 : #2}}{\braces{#1}}%
}

% Define style of vectors and matrices.
\if@boldmath
  \def\@symbolstyle#1{\boldsymbol{#1}}
\else
  \def\@symbolstyle#1{\relax#1}
\fi
% Typeset a symbol as (v)ector or (m)atrix.
\newcommand*{\vm}[1]{\@symbolstyle{#1}}
% Define a symbol range. The starred variant treats the symbol names as macros
% upon expansion, e.g., \vm{\sigma} rather than \vm{sigma}.
\DeclareDocumentCommand{\@definesymbols}{s m}{
  \foreach \s in {#2}{
    \expandafter\xdef\csname vm\s\endcsname{
      \noexpand\vm{\IfBooleanTF{#1}{\csname\s\endcsname}{\s}}
    }
  }
}
\@definesymbols{a,...,z}
\@definesymbols{A,...,Z}
\@definesymbols*{
  alpha,beta,gamma,delta,epsilon,varepsilon,zeta,eta,theta,vartheta,iota,kappa,
  lambda,mu,nu,xi,o,pi,rho,varrho,sigma,tau,upsilon,phi,varphi,chi,psi,omega
}
\@definesymbols*{
  Gamma,Delta,Theta,Lambda,Xi,Pi,Sigma,Upsilon,Phi,Psi,Omega
}
% Identity operator
\newcommand*{\Id}{\vm{\mathrm{Id}}}

% -- Parenthesis, brackets and braces --
\newcommand*{\parens}[1]{\left(#1\right)}
\newcommand*{\brackets}[1]{\left[#1\right]}
\newcommand*{\braces}[1]{\left\{#1\right\}}

% -- Operators & functions --
% Function definition
\newcommand*{\function}[3]{#1 \colon #2 \to #3}
% Probability measure
\renewcommand*{\P}{\mathbb{P}}
% Expected value
\newcommand*{\E}{\mathbb{E}}
% Variance
\DeclareMathOperator{\var}{Var}
% Covariance
\DeclareMathOperator{\cov}{Cov}
% Entropy
\DeclareMathOperator{\ent}{H}
% Mutual information
\newcommand*{\mi}[2]{\operatorname{I}\left(#1;#2\right)}
% Rank
\DeclareMathOperator{\rank}{rank}
% Trace
\DeclareMathOperator{\tr}{tr}
% Transpose
\newcommand*{\transp}[1]{#1^\top}
% Adjoint
\newcommand*{\adj}[1]{#1^*}
% Complex conjugation
\newcommand*{\conj}[1]{\overline{#1}}
% Orthogonal complement
\newcommand*{\ocomp}[1]{#1^\bot}
% Optimal point
\newcommand*{\opt}[1]{#1^\star}
% Real and imaginary part
\renewcommand*{\Re}{\operatorname{Re}}
\renewcommand*{\Im}{\operatorname{Im}}
% Inner product
\newcommand*{\inner}[2]{\left\langle#1,#2\right\rangle}
% Diagonal matrix
\newcommand*{\diag}[1]{\operatorname{diag}\braces{#1}}
% Cardinality of a set
\newcommand*{\card}{\#}
% Signum function
\DeclareMathOperator{\sgn}{sgn}
% Domain of a function
\newcommand*{\dom}{\mathoperator{dom}}
% argmin
\newcommand*{\argmin}[2]{\operatorname*{argmin}_{#1}\braces{#2}}
% argmax
\newcommand*{\argmax}[2]{\operatorname*{argmax}_{#1}\braces{#2}}
% arginf
\newcommand*{\arginf}[2]{\operatorname*{arginf}_{#1}\braces{#2}}
% argsup
\newcommand*{\argsup}[2]{\operatorname*{argsup}_{#1}\braces{#2}}
% Proximal operator
\newcommand*{\prox}[1]{\operatorname{prox}_{#1}}
% Hard-thresholding operator
\newcommand*{\hard}[1]{H_{#1}}
% Soft-thresholding operator
\newcommand*{\shrink}[1]{S_{#1}}
% Indicator function
\newcommand*{\indicator}[1]{\iota_{#1}}

% Math environments
\DeclareDocumentCommand{\Equation}{s m}{%
  \IfBooleanTF{#1}{\Env{align*}{#2}}{\Env{align}{#2}}%
}
\newcommand*{\PMatrix}[1]{\Env{pmatrix}{#1}}
\newcommand*{\Cases}[1]{\Env{cases}{#1}}

% Optimization problems
\DeclareDocumentCommand{\Problem}{m o m m m}{%
  \begin{array}{cl}
    \IfValueTF{#2}{\operatorname*{#1}\limits_{#2}}{\operatorname{#1}} & #3 \\
    \text{#4} &
    \setlength\arraycolsep{0pt}
    \begin{array}[t]{l}
      #5
    \end{array}
  \end{array}
}

\DeclareDocumentCommand{\ProblemSimple}{m o m m m}{%
  \def\@padding{\;\;}
  \IfValueTF{#2}{\operatorname*{#1}\limits_{#2}}{\operatorname{#1}} \@padding %
  #3 \@padding \text{#4} \@padding #5
}

% -- Miscellaneous --
% Upright infinitesimal sign for things like df/dx, etc.
\renewcommand*{\d}[1]{\mathrm{d}#1}
% Redefine \iff to use \Leftrightarrow in place of \Longleftrightarrow.
\renewcommand*{\iff}{\Leftrightarrow}
% Corresponds to
\newcommand*{\correspondsto}{\mathrel{\widehat{=}}}

% -- Differential geometry --
% Manifolds
\newcommand*{\man}[1]{\mathcal{#1}}
\newcommand*{\manM}{\man{M}}
\newcommand*{\manN}{\man{N}}
% Directional derivative
\DeclareDocumentCommand{\dderiv}{m o}{%
  % Using \operatorname here adds unwanted whitespace after D.
  % \mathrm{D}{#1}\IfValueT{#2}{[#2]}%
  \mathrm{D}\IfValueT{#2}{_{#2}}{#1}%
}
% Riemannian gradient
\newcommand*{\rgrad}{\operatorname{grad}}
% Tangent space/bundle
\DeclareDocumentCommand{\tspace}{o m}{%
  T\IfValueT{#1}{_{#1}}#2%
}
% Retraction
\newcommand*{\ret}{R}
% Projection onto subspace
\newcommand*{\proj}[1]{\Pi_{#1}}

\endinput
